# å·¥å…·æ³¨å†Œæ£€æŸ¥æ¸…å•

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. å‰ç«¯ç»„ä»¶æ•´åˆ (webview-ui)
æ‰€æœ‰å·¥å…·ç»„ä»¶å·²æˆåŠŸæ•´åˆåˆ° `chat-tools.tsx` ä¸­ï¼š

#### æœç´¢å·¥å…·
- âœ… `GrepSearchToolBlock` - grepæœç´¢ (ç¬¬1168-1366è¡Œ)
- âœ… `PatternSearchToolBlock` - æ¨¡å¼æœç´¢ (ç¬¬1368-1553è¡Œ)

#### ç»ˆç«¯ç›‘æ§å·¥å…·
- âœ… `ReadProgressToolBlock` - ç»ˆç«¯è¿›åº¦ç›‘æ§ (ç¬¬1851-2007è¡Œ)

#### æ–‡ä»¶æ“ä½œå·¥å…·
- âœ… `RenameToolBlock` - é‡å‘½å (ç¬¬1558-1608è¡Œ)
- âœ… `RemoveToolBlock` - åˆ é™¤ (ç¬¬1610-1656è¡Œ)
- âœ… `ReplaceStringToolBlock` - å­—ç¬¦ä¸²æ›¿æ¢ (ç¬¬1658-1717è¡Œ)
- âœ… `MultiReplaceStringToolBlock` - å¤šå­—ç¬¦ä¸²æ›¿æ¢ (ç¬¬1719-1788è¡Œ)
- âœ… `InsertEditToolBlock` - æ’å…¥ç¼–è¾‘ (ç¬¬1790-1849è¡Œ)

### 2. ToolRenderer æ³¨å†Œ (ç¬¬2013-2072è¡Œ)
æ‰€æœ‰å·¥å…·éƒ½å·²åœ¨ switch case ä¸­æ­£ç¡®æ³¨å†Œï¼š

```typescript
case "grep_search": return <GrepSearchToolBlock {...tool} />
case "pattern_search": return <PatternSearchToolBlock {...tool} />
case "read_progress": return <ReadProgressToolBlock {...tool} />
case "rename": return <RenameToolBlock {...tool} />
case "remove": return <RemoveToolBlock {...tool} />
case "replace_string": return <ReplaceStringToolBlock {...tool} />
case "multi_replace_string": return <MultiReplaceStringToolBlock {...tool} />
case "insert_edit": return <InsertEditToolBlock {...tool} />
case "fast_editor": return <FastEditorToolBlock {...tool} />
```

### 3. åç«¯å·¥å…·æ³¨å†Œ (extension/src/agent/v1/tools/tool-executor.ts)
æ‰€æœ‰å·¥å…·éƒ½å·²åœ¨ `toolMap` ä¸­æ³¨å†Œï¼š

```typescript
const toolMap = {
    grep_search: GrepSearchTool,           // âœ… ç¬¬161è¡Œ
    pattern_search: PatternSearchTool,     // âœ… ç¬¬162è¡Œ
    read_progress: ReadProgressTool,       // âœ… ç¬¬160è¡Œ
    rename: RenameTool,                    // âœ… ç¬¬156è¡Œ
    remove: RemoveTool,                    // âœ… ç¬¬155è¡Œ
    replace_string: ReplaceStringTool,     // âœ… ç¬¬151è¡Œ
    multi_replace_string: MultiReplaceStringTool, // âœ… ç¬¬152è¡Œ
    insert_edit: InsertEditTool,           // âœ… ç¬¬153è¡Œ
    fast_editor: FastEditorTool,           // âœ… ç¬¬150è¡Œ
}
```

### 4. ç±»å‹å®šä¹‰ (extension/src/shared/new-tools.ts)
æ‰€æœ‰å·¥å…·ç±»å‹éƒ½å·²æ­£ç¡®å®šä¹‰ï¼š

- âœ… `GrepSearchTool` (ç¬¬230-237è¡Œ)
- âœ… `PatternSearchTool` (ç¬¬220-228è¡Œ)
- âœ… `ReadProgressTool` (ç¬¬239-252è¡Œ)
- âœ… `RenameTool` (ç¬¬254-260è¡Œ)
- âœ… `RemoveTool` (ç¬¬262-268è¡Œ)
- âœ… `ReplaceStringTool` (ç¬¬270-280è¡Œ)
- âœ… `MultiReplaceStringTool` (ç¬¬282-298è¡Œ)
- âœ… `InsertEditTool` (ç¬¬300-306è¡Œ)

### 5. å¯¼å…¥æ£€æŸ¥
- âœ… `Badge` ç»„ä»¶å·²å¯¼å…¥ (ç¬¬76è¡Œ)
- âœ… æ‰€æœ‰å·¥å…·ç±»å‹å·²ä» `extension/shared/new-tools` å¯¼å…¥ (ç¬¬45-72è¡Œ)
- âœ… æ‰€æœ‰å¿…è¦çš„ lucide-react å›¾æ ‡å·²å¯¼å…¥ (ç¬¬4-43è¡Œ)

### 6. å·²åˆ é™¤çš„ç‹¬ç«‹æ–‡ä»¶
- âœ… `grep-search-tool.tsx`
- âœ… `pattern-search-tool.tsx`
- âœ… `read-progress-tool.tsx`
- âœ… `file-operations-tool.tsx`

## ğŸ” éªŒè¯æ­¥éª¤

### æ–¹æ³•1: æ„å»º VSIX åŒ…
```bash
cd extension
pnpm run package
```

### æ–¹æ³•2: å¼€å‘æ¨¡å¼æµ‹è¯•
1. æŒ‰ F5 å¯åŠ¨æ‰©å±•å¼€å‘ä¸»æœº
2. åœ¨æ–°çª—å£ä¸­æµ‹è¯•å·¥å…·è°ƒç”¨
3. æ£€æŸ¥æ˜¯å¦æœ‰ä»¥ä¸‹é”™è¯¯ï¼š
   - ç»„ä»¶æœªå®šä¹‰
   - å¯¼å…¥é”™è¯¯
   - ç±»å‹ä¸åŒ¹é…

### æ–¹æ³•3: æ£€æŸ¥æ§åˆ¶å°
æ‰“å¼€å¼€å‘è€…å·¥å…· (Ctrl+Shift+I)ï¼ŒæŸ¥çœ‹ï¼š
- âŒ çº¢è‰²é”™è¯¯ï¼šç»„ä»¶æ¸²æŸ“å¤±è´¥
- âš ï¸ é»„è‰²è­¦å‘Šï¼šç±»å‹è­¦å‘Šæˆ–å¼ƒç”¨è­¦å‘Š
- âœ… æ— é”™è¯¯ï¼šå·¥å…·æ­£å¸¸å·¥ä½œ

## ğŸ“‹ æµ‹è¯•ç”¨ä¾‹

### æµ‹è¯• grep_search
```
è¯·æœç´¢é¡¹ç›®ä¸­æ‰€æœ‰åŒ…å« "FastEditorTool" çš„æ–‡ä»¶
```
é¢„æœŸï¼šæ˜¾ç¤º GrepSearchToolBlock ç»„ä»¶ï¼ŒåŒ…å«æœç´¢ç»“æœ

### æµ‹è¯• pattern_search
```
åˆ†æ src/tools/*.ts æ–‡ä»¶ä¸­ BaseAgentTool çš„ä½¿ç”¨æ¨¡å¼
```
é¢„æœŸï¼šæ˜¾ç¤º PatternSearchToolBlock ç»„ä»¶ï¼ŒåŒ…å«æ¨¡å¼åˆ†æ

### æµ‹è¯• read_progress
```
ç›‘æ§ç»ˆç«¯1çš„è¾“å‡ºè¿›åº¦
```
é¢„æœŸï¼šæ˜¾ç¤º ReadProgressToolBlock ç»„ä»¶ï¼Œæ˜¾ç¤ºç»ˆç«¯çŠ¶æ€

### æµ‹è¯• file operations
```
è¯·å°† test.txt é‡å‘½åä¸º test-new.txt
```
é¢„æœŸï¼šæ˜¾ç¤º RenameToolBlock ç»„ä»¶ï¼Œæ˜¾ç¤ºé‡å‘½åæ“ä½œ

## âš ï¸ å¸¸è§é—®é¢˜

### é—®é¢˜1: ç»„ä»¶æœªæ¸²æŸ“
**ç—‡çŠ¶**: å·¥å…·è°ƒç”¨åç•Œé¢ç©ºç™½æˆ–æ˜¾ç¤º null
**æ£€æŸ¥**:
1. ToolRenderer ä¸­çš„ case æ˜¯å¦åŒ¹é…å·¥å…·åç§°
2. ç»„ä»¶æ˜¯å¦æ­£ç¡®å¯¼å‡º (export const)
3. ç±»å‹å®šä¹‰æ˜¯å¦æ­£ç¡®

### é—®é¢˜2: ç±»å‹é”™è¯¯
**ç—‡çŠ¶**: TypeScript ç¼–è¯‘é”™è¯¯
**æ£€æŸ¥**:
1. shared/new-tools.ts ä¸­çš„ç±»å‹å®šä¹‰
2. ç»„ä»¶ props æ˜¯å¦ä¸ç±»å‹åŒ¹é…
3. ToolAddons ç±»å‹æ˜¯å¦æ­£ç¡®åº”ç”¨

### é—®é¢˜3: æ ·å¼é—®é¢˜
**ç—‡çŠ¶**: ç»„ä»¶æ˜¾ç¤ºä½†æ ·å¼ä¸æ­£ç¡®
**æ£€æŸ¥**:
1. Tailwind CSS ç±»åæ˜¯å¦æ­£ç¡®
2. index.css ä¸­çš„è‡ªå®šä¹‰æ ·å¼æ˜¯å¦å­˜åœ¨
3. ä¸»é¢˜å˜é‡æ˜¯å¦æ­£ç¡®ä½¿ç”¨

## ğŸ¯ å‚è€ƒå·¥å…·å¯¹æ¯”

ä»¥ `fast_editor` ä¸ºå‚è€ƒï¼ˆå·²çŸ¥å¯ç”¨ï¼‰ï¼š

| æ£€æŸ¥é¡¹ | fast_editor | grep_search | çŠ¶æ€ |
|--------|-------------|-------------|------|
| åç«¯æ³¨å†Œ | âœ… tool-executor.ts | âœ… tool-executor.ts | âœ… |
| ç±»å‹å®šä¹‰ | âœ… new-tools.ts | âœ… new-tools.ts | âœ… |
| å‰ç«¯ç»„ä»¶ | âœ… fast-editor-tool.tsx | âœ… chat-tools.tsx | âœ… |
| ToolRenderer | âœ… case "fast_editor" | âœ… case "grep_search" | âœ… |
| å¯¼å…¥è¯­å¥ | âœ… å·²å¯¼å…¥ | âœ… å·²å¯¼å…¥ | âœ… |

## âš ï¸ å‘ç°çš„é—®é¢˜

### å·¥å…·åç§°ä¸ä¸€è‡´
åç«¯ schema å®šä¹‰ä¸å‰ç«¯ä½¿ç”¨çš„åç§°å­˜åœ¨å·®å¼‚ï¼š

| å‰ç«¯/shared | åç«¯ schema | çŠ¶æ€ |
|-------------|-------------|------|
| `replace_string` | `replace_string_in_file` | âš ï¸ éœ€ç¡®è®¤ |
| `multi_replace_string` | `multi_replace_string_in_file` | âš ï¸ éœ€ç¡®è®¤ |
| `insert_edit` | æœªæ‰¾åˆ°schema | âš ï¸ éœ€ç¡®è®¤ |

**è¯´æ˜**ï¼š
- `tool-executor.ts` ä¸­ä½¿ç”¨çš„æ˜¯ `replace_string` ç­‰çŸ­åç§°
- `schema/*.ts` ä¸­å®šä¹‰çš„æ˜¯ `replace_string_in_file` ç­‰é•¿åç§°
- å¯èƒ½å­˜åœ¨åç§°æ˜ å°„å±‚ï¼Œéœ€è¦åœ¨å®é™…è¿è¡Œæ—¶éªŒè¯

## âœ¨ æ€»ç»“

æ‰€æœ‰å·¥å…·çš„æ³¨å†Œé€»è¾‘å·²å®Œæ•´å®ç°ï¼š
- âœ… å‰ç«¯ç»„ä»¶å·²æ•´åˆåˆ° chat-tools.tsx
- âœ… ToolRenderer ä¸­å·²æ³¨å†Œæ‰€æœ‰ case
- âœ… åç«¯ tool-executor ä¸­å·²æ³¨å†Œ
- âœ… ç±»å‹å®šä¹‰å®Œæ•´
- âœ… å¯¼å…¥è¯­å¥æ­£ç¡®
- âœ… Linter æ£€æŸ¥é€šè¿‡
- âš ï¸ éƒ¨åˆ†å·¥å…·åç§°éœ€è¦åœ¨è¿è¡Œæ—¶éªŒè¯

**å»ºè®®ä¸‹ä¸€æ­¥**ï¼š
1. **æ„å»º VSIX åŒ…è¿›è¡Œå®Œæ•´æµ‹è¯•** â­ æœ€é‡è¦
2. åœ¨å¼€å‘æ¨¡å¼ä¸‹æµ‹è¯•æ¯ä¸ªå·¥å…·
3. æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰è¿è¡Œæ—¶é”™è¯¯
4. éªŒè¯å·¥å…·åç§°æ˜ å°„æ˜¯å¦æ­£ç¡®
5. å¦‚æœå‡ºç° "Unknown tool" é”™è¯¯ï¼Œæ£€æŸ¥åç§°æ˜ å°„

